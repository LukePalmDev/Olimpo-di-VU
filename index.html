<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galleria – Scorrimento in loop</title>
  <style>
    :root {
      --bg: #0f1115;
      --fg: #e6e6e6;
      --muted: #9aa0a6;
      --accent: #7c3aed;
      --card: #171923;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 50% -10%, #1b1f2a 0%, var(--bg) 60%);
      background-color: var(--bg); /* anti white flash */
      color: var(--fg);
      padding: 24px;
      min-height: 100svh; /* mobile viewport robust */
      overflow-x: hidden; /* evita scorrimento orizzontale */
      overflow-y: hidden; /* blocca scroll per evitare "bianco" dietro */
      display: grid; place-items: center;
    }

    .wrap {
      width: min(92vw, 960px);
      display: grid;
      gap: 18px;
      min-height: 100%;
      place-items: center; /* centra anche prima del load */
    }

    .stage {
      position: relative;
      background: var(--card);
      border-radius: 24px;
      padding: 18px 18px 8px; /* più spazio per meta */
      box-shadow: var(--shadow);
    }

    .frame {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1; /* foto quadrata */
      border-radius: 16px;
      overflow: hidden;
      background: #0b0d12;
      margin: 0 auto;
    }
    .frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      user-select: none;
      -webkit-user-drag: none;
      transition: transform .35s ease;
    }
    .frame.loading img { opacity: .6; filter: blur(2px); }

    .navBtn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 48px; height: 48px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(10,12,18,.55);
      backdrop-filter: blur(6px);
      display: grid; place-items: center;
      cursor: pointer;
      transition: background .2s ease, transform .08s ease;
    }
    .navBtn:hover { background: rgba(10,12,18,.75); }
    .navBtn:active { transform: translateY(-50%) scale(.97); }
    .navLeft { left: 14px; }
    .navRight { right: 14px; }
    .navBtn svg { width: 22px; height: 22px; fill: currentColor; color: #fff; }

    .dots {
      margin-top: 10px;
      display: flex; gap: 6px; justify-content: center; flex-wrap: wrap;
    }
    .dot {
      width: 8px; height: 8px; border-radius: 999px; opacity: .35; background: #fff; transition: opacity .2s ease;
    }
    .dot.active { opacity: 1; }

    .meta {
      display: grid; gap: 8px; padding: 10px 8px 12px;
      text-align: center;
      min-height: 90px; /* più spazio per nome + dio */
    }
    .name { font-weight: 800; font-size: clamp(18px, 2.6vw, 24px); letter-spacing: .2px; }
    .deity { color: var(--muted); font-size: clamp(15px, 2.2vw, 18px); }

    a { color: var(--fg); }

    @media (hover: none) and (pointer: coarse) {
      .navBtn { display: none; }
    }

    /* Mobile tweaks */
    @media (max-width: 600px) {
      body { padding: 16px; }
      .wrap { width: 100%; }
      .stage { padding: 14px 14px 10px; }
      .frame { width: 90vw; }
      .meta { gap: 10px; min-height: 104px; }
      .name { font-size: 22px; }
      .deity { font-size: 18px; }
    }
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Galleria di foto con scorrimento in loop">
    <div class="stage">
      <div class="frame" id="frame" aria-live="polite">
        <img id="photo" src="" alt="" />
        <button class="navBtn navLeft" id="prevBtn" aria-label="Foto precedente">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
        </button>
        <button class="navBtn navRight" id="nextBtn" aria-label="Foto successiva">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
        </button>
      </div>
      <div class="dots" id="dots" aria-hidden="true"></div>
      <div class="meta">
        <div class="name" id="name">&nbsp;</div>
        <div class="deity" id="deity">&nbsp;</div>
      </div>
    </div>
  </div>

  <script id="gallery-data" type="application/json">
  {
    "items": [
      { "src": "Images/1.png",  "name": "Salvatore",  "deity": "Crono" },
      { "src": "Images/2.png",  "name": "Roberto",  "deity": "Zues" },
      { "src": "Images/3.png",  "name": "Fabio",  "deity": "Poseidone" },
      { "src": "Images/4.png",  "name": "Francesco",  "deity": "Ares" },
      { "src": "Images/5.png",  "name": "Andrea",  "deity": "Efesto" },
      { "src": "Images/6.png",  "name": "Carmen",  "deity": "Era" },
      { "src": "Images/7.png",  "name": "Salvatore",  "deity": "Ade" },
      { "src": "Images/8.png",  "name": "Fabiana",  "deity": "Atena" },
      { "src": "Images/9.png",  "name": "Martina",  "deity": "Demetra" },
      { "src": "Images/10.png", "name": "Rosaria", "deity": "Afrodite" },
      { "src": "Images/11.png", "name": "Assia", "deity": "Artemide" },
      { "src": "Images/12.png", "name": "Daniele", "deity": "Ermes" }
    ]
  }
  </script>

  <script>
    (function(){
      function readData(){
        const el = document.getElementById('gallery-data');
        try { return JSON.parse(el.textContent).items || []; }
        catch(e){ console.error('JSON non valido', e); return []; }
      }

      const items = readData();
      if (!Array.isArray(items) || items.length === 0) {
        alert('Nessun elemento nella galleria. Inserisci le foto nel JSON.');
        return;
      }

      const total = items.length;
      let index = 0;

      const frame  = document.getElementById('frame');
      const img    = document.getElementById('photo');
      const nameEl = document.getElementById('name');
      const deityEl= document.getElementById('deity');
      const dotsEl = document.getElementById('dots');

      const dots = [];
      for (let i=0;i<total;i++){
        const d = document.createElement('div');
        d.className = 'dot' + (i===0?' active':'');
        dotsEl.appendChild(d);
        dots.push(d);
      }

      function preload(src){
        const im = new Image();
        im.src = src;
      }

      function render(newIndex){
        index = (newIndex % total + total) % total;
        const item = items[index];
        frame.classList.add('loading');
        const nextImg = new Image();
        nextImg.onload = () => {
          img.src = nextImg.src;
          img.alt = (item.name ? item.name + ' – ' : '') + (item.deity || '');
          nameEl.textContent = item.name || '';
          deityEl.textContent = item.deity || '';
          dots.forEach((d,i)=> d.classList.toggle('active', i===index));
          frame.classList.remove('loading');
        };
        nextImg.src = item.src;

        const nxt = items[(index+1)%total]?.src;
        const prv = items[(index-1+total)%total]?.src;
        if (nxt) preload(nxt);
        if (prv) preload(prv);
      }

      function next(){ render(index + 1); }
      function prev(){ render(index - 1); }

      document.getElementById('nextBtn').addEventListener('click', next);
      document.getElementById('prevBtn').addEventListener('click', prev);

      window.addEventListener('keydown', (e)=>{
        if (e.key === 'ArrowRight') next();
        else if (e.key === 'ArrowLeft') prev();
      });

      let startX = null, startY = null, moved = false;
      const swipeZone = frame;
      swipeZone.addEventListener('touchstart', e=>{
        const t = e.touches[0];
        startX = t.clientX; startY = t.clientY; moved = false;
      }, {passive:true});
      swipeZone.addEventListener('touchmove', e=>{ moved = true; }, {passive:true});
      swipeZone.addEventListener('touchend', e=>{
        if (startX===null || !moved) return;
        const t = e.changedTouches[0];
        const dx = t.clientX - startX; const dy = Math.abs(t.clientY - startY);
        if (Math.abs(dx) > 30 && dy < 80) {
          if (dx < 0) next(); else prev();
        }
        startX = startY = null; moved = false;
      });

      let lastIndex = 0;
      const animate = (toRight)=>{
        img.style.transform = `scale(1.02) translateX(${toRight?'-12px':'12px'})`;
        requestAnimationFrame(()=>{
          setTimeout(()=>{ img.style.transform = 'none'; }, 220);
        });
      };
      const originalRender = render;
      render = function(newIndex){
        const toRight = newIndex > lastIndex || (newIndex===0 && lastIndex===total-1);
        lastIndex = (newIndex % total + total) % total;
        animate(toRight);
        originalRender(newIndex);
      };

      // Render immediato (centra l'interfaccia anche prima del load effettivo)
      render(0);
    })();
  </script>
</body>
</html>